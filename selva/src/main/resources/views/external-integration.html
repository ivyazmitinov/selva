<!DOCTYPE html>
<html lang="en"
      th:replace="~{layout :: layout(~{::title}, ~{::script}, ~{::link}, ~{::#main})}"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Selva™ • External Integration Edit</title>
    <script src="/assets/js/external-integration.js"></script>
    <link/>
</head>
<div id="main" class="flex flex-col items-center size-auto py-20">
    <div class="border border-gray-200 rounded-lg w-[40%] shadow-lg inset-shadow-sm pb-5">
        <form th:action="${externalIntegration != null} ? ${'/app/external-integration/' + externalIntegration.id()} : ${'/app/external-integration/'}"
              id="external-integration-form"
              method="post"
              enctype="multipart/form-data">
            <div class="mx-16 my-5">
                <div class="flex gap-3 align-bottom pb-1">
                    <th:block th:if="${externalIntegration != null}">
                        <img th:if="${externalIntegration.logo() != null}"
                             th:src="|data:${externalIntegration.logo().format()};base64,${integrationLogo}|"
                             th:alt="|${externalIntegration.name()} Logo|"
                             class="size-8 inline">
                        <h1 th:text="|${externalIntegration.name} Integration Edit|"
                            class="text-4xl font-bold font-[Oswald] text-gray-900 mb-5"></h1>
                    </th:block>
                    <h1 th:if="${externalIntegration == null}"
                        class="text-4xl font-bold font-[Oswald] text-gray-900 mb-5 inline">
                        New External Integration Edit</h1>
                </div>
                <p class="text-sm">Create a template for new user profiles</p>
            </div>
            <div class="flex justify-center-safe">
                <div class="h-px shrink-0 flex-none bg-cyan-700 w-[90%]">
                </div>
            </div>
            <fieldset id="fieldset" class="m-5">
                <div class="flex mb-2 fields-container">
                    <!--  Placeholder for a add button   -->
                    <div class="mr-2 size-10">
                    </div>
                    <div class="grid grid-cols-2 gap-3 w-full">
                        <div class="flex flex-col pl-1">
                            <label for="name" class="inline my-auto">Integration Name:</label>
                        </div>
                        <input type="text"
                               id="name"
                               name="name"
                               th:value="${externalIntegration != null} ? ${externalIntegration.name}"
                               required
                               class="shadow-sm
                                           text-gray-900 border
                                           border-gray-300
                                           rounded-lg
                                           focus:ring-0
                                           focus:outline-none
                                           focus:ring-cyan-600
                                           focus:border-cyan-600
                                           h-9
                                           p-1.5"/>
                    </div>
                </div>
                <div class="flex mb-2 fields-container">
                    <!--  Placeholder for a add button   -->
                    <div class="mr-2 size-10">
                    </div>
                    <div class="grid grid-cols-2 gap-3 w-full">
                        <div class="flex flex-col pl-1">
                            <label for="logo" class="inline my-auto">Integration Logo:</label>
                        </div>
                        <input type="file"
                               id="logo"
                               name="logo"
                               accept="image/*"
                               class="
                                text-slate-500
                                font-medium
                                text-sm
                                bg-gray-100
                                cursor-pointer
                                file:cursor-pointer
                                file:border-0
                                file:py-2
                                file:px-4
                                file:mr-4
                                 file:bg-cyan-800
                                 file:hover:bg-cyan-700
                                 file:text-white
                                 rounded-lg"/>

                    </div>
                </div>
                <div th:if="${apiKey != null}" class="flex mb-2 fields-container">
                    <!--  Placeholder for a add button   -->
                    <div class="mr-2 size-10">
                    </div>
                    <div class="grid grid-cols-2 gap-3 w-full">
                        <div class="flex flex-col bg-green-400 rounded-lg pl-1 text-sm">
                            <label for="api-key" class="block my-auto">Your API key.</label>
                            <p class="font-bold">Save now, won't be accessible later</p>
                        </div>
                        <div class="flex">
                            <input type="text"
                                   id="api-key"
                                   readonly
                                   disabled
                                   name="api-key"
                                   th:value="${apiKey}"
                                   class="shadow-sm
                                    w-full
                                   text-gray-900 border
                                   border-gray-300
                                   bg-gray-200
                                   rounded-lg
                                   focus:ring-0
                                   focus:outline-none
                                   focus:ring-cyan-600
                                   focus:border-cyan-600
                                   h-9
                                   p-1.5"/>
                            <div title="Copy API key to clipboard"
                                 class="inline ml-1 p-1 hover:bg-gray-200  hover:rounded-lg  cursor-pointer my-auto ">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     id="copy-api-key-to-clipboard"
                                     fill="none"
                                     viewBox="0 0 24 24"
                                     stroke-width="1.5"
                                     stroke="currentColor"
                                     class="size-6">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                          d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z"/>
                                </svg>
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     fill="none"
                                     id="copy-api-key-to-clipboard-ok"
                                     viewBox="0 0 24 24"
                                     stroke-width="1.5"
                                     stroke="currentColor"
                                     class="size-6 hidden">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5"/>
                                </svg>

                            </div>
                        </div>
                    </div>
                </div>
                <div id="editable-fields">
                    <th:block th:if="${externalIntegration != null}"
                              th:each="field : ${externalIntegrationFields}">
                        <div class="flex mb-2 fields-container transition-opacity duration-200 ease-in opacity-100"
                             th:id="|${field.getKey()}-container|">
                            <div class="mr-2"
                                 title="Remove a field">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     th:id="|${field.getKey()}-remove-button|"
                                     th:attr="onclick=|removeFields('${field.getKey()}')|,data-testid=|new-field-${field.getValue().order()}-remove-button|"
                                     fill="none"
                                     viewBox="0 0 24 24"
                                     stroke-width="1"
                                     tabindex="0"
                                     class="
                              size-10
                              stroke-sky-400
                              transition-all
                              transform
                              duration-400
                              hover:rotate-180
                              focus:rotate-180
                              select-none
                              hover:stroke-red-600
                              focus:stroke-red-600
                              focus:outline-0
                              cursor-pointer">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                          d="M15 12H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                                </svg>
                            </div>
                            <div class="grid grid-cols-2 gap-2 w-full">
                                <input type="text"
                                       required
                                       th:attr="data-testid=|new-field-${field.getValue().order()}-label|"
                                       th:id="|${field.getKey()}-label|"
                                       th:name="|${field.getKey()}__label|"
                                       th:value="|${field.getValue().name()}|"
                                       class="shadow-sm  text-gray-900 border border-gray-300 sm:text-sm rounded-lg  focus:ring-0 focus:outline-none focus:ring-cyan-600 focus:border-cyan-600 h-9 p-1.5">
                                <input type="hidden"
                                       th:id="|${field.getKey()}-order|"
                                       th:name="|${field.getKey()}__order|"
                                       th:value="${field.getValue().order()}"/>
                                <select th:id="|${field.getKey()}-type|" th:name="|${field.getKey()}__type|"
                                        th:attr="data-testid=|new-field-${field.getValue().order()}-type|"
                                        class="shadow-sm
                                        border
                                        border-gray-300
                                        disabled:bg-gray-200
                                         sm:text-sm
                                        rounded-lg
                                        h-9
                                        p-1.5
                                        text-gray-700
                                        focus:border-cyan-600
                                        focus:ring-0
                                        focus:outline-0
                                        cursor-pointer">
                                    <option th:selected="${field.getValue().type().toString() == 'TEXT'}" value="text">
                                        Text
                                    </option>
                                    <option th:selected="${field.getValue().type().toString() == 'DATE'}" value="date">
                                        Date
                                    </option>
                                    <option th:selected="${field.getValue().type().toString() == 'FILE'}" value="file">
                                        File
                                    </option>
                                </select>
                            </div>
                        </div>
                    </th:block>
                </div>
                <div class="flex justify-start">
                    <div title="Add new field">
                        <svg xmlns="http://www.w3.org/2000/svg"
                             fill="none"
                             viewBox="0 0 24 24"
                             stroke-width="1"
                             tabindex="0"
                             class="size-10
                          stroke-sky-400
                          transition-all
                          transform
                          duration-400
                          hover:rotate-90
                          focus:rotate-90
                          hover:stroke-green-400
                          focus:stroke-green-400
                          focus:outline-0
                          select-none
                          cursor-pointer"
                             id="add-new-field">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                  d="M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                        </svg>
                    </div>
                </div>
            </fieldset>
        </form>
        <form th:if="${externalIntegration != null}"
              th:action="${'/app/external-integration/' + externalIntegration.id()} + '/update-token'"
              method="post"
              enctype="multipart/form-data"
              id="update-token-form">
        </form>
        <form th:if="${externalIntegration != null}"
              th:action="${'/app/external-integration/' + externalIntegration.id()} + '/delete'"
              method="post"
              enctype="multipart/form-data"
              id="delete-integration-form">
        </form>
        <div class="flex justify-center gap-2">
            <input type="submit"
                   id="submit"
                   value="Submit"
                   form="external-integration-form"
                   class="bg-sky-400
                           text-white
                           py-1.5
                           px-2.5
                           rounded
                           hover:bg-sky-600
                           focus:outline-none
                           focus:shadow-outline
                           cursor-pointer
                           w-1/4"/>
            <input type="submit"
                   th:if="${externalIntegration != null}"
                   form="update-token-form"
                   id="update-token"
                   value="Generate new token"
                   class="bg-sky-400
                           text-white
                           py-1.5
                           px-2.5
                           rounded
                           hover:bg-green-600
                           focus:outline-none
                           focus:shadow-outline
                           cursor-pointer
                           w-1/4"/>
            <input type="submit"
                   id="delete-integration-form-submit"
                   th:if="${externalIntegration != null}"
                   value="Delete integration"
                   class="bg-red-500
                           text-white
                           py-1.5
                           px-2.5
                           rounded
                           hover:bg-red-700
                           focus:outline-none
                           focus:shadow-outline
                           cursor-pointer
                           w-1/4"/>
        </div>
    </div>
</div>
</html>